const _0x428cdb=_0x291e;(function(_0x309e4a,_0xe5f80a){const _0x13711a=_0x291e,_0x3d15a6=_0x309e4a();while(!![]){try{const _0x307bb1=parseInt(_0x13711a(0x1f3))/0x1+parseInt(_0x13711a(0x18a))/0x2*(-parseInt(_0x13711a(0x1ef))/0x3)+-parseInt(_0x13711a(0x1fe))/0x4*(parseInt(_0x13711a(0x1b0))/0x5)+-parseInt(_0x13711a(0x1fa))/0x6*(-parseInt(_0x13711a(0x1a5))/0x7)+-parseInt(_0x13711a(0x1c3))/0x8+-parseInt(_0x13711a(0x1f0))/0x9+parseInt(_0x13711a(0x1aa))/0xa*(parseInt(_0x13711a(0x1ae))/0xb);if(_0x307bb1===_0xe5f80a)break;else _0x3d15a6['push'](_0x3d15a6['shift']());}catch(_0x437551){_0x3d15a6['push'](_0x3d15a6['shift']());}}}(_0x2d52,0xd82af));const bodyParser=require('body-parser'),cors=require(_0x428cdb(0x1d4)),express=require(_0x428cdb(0x1ad)),fs=require('fs'),path=require(_0x428cdb(0x20b)),{v4:uuidv4}=require(_0x428cdb(0x243)),archiver=require(_0x428cdb(0x1b2)),os=require('os'),{exec}=require(_0x428cdb(0x211)),networkInterfaces=os[_0x428cdb(0x244)](),serverIp=Object[_0x428cdb(0x207)](networkInterfaces)[_0x428cdb(0x219)]()[_0x428cdb(0x1b7)](_0x2f25be=>!_0x2f25be[_0x428cdb(0x221)]&&_0x2f25be[_0x428cdb(0x191)]==='IPv4')?.[_0x428cdb(0x231)]||_0x428cdb(0x1eb),main_dir=_0x428cdb(0x23e),multer=require(_0x428cdb(0x236)),uploadSessionsDir=path[_0x428cdb(0x22e)](process[_0x428cdb(0x1df)](),_0x428cdb(0x1bd)),tempDir=path['join'](process[_0x428cdb(0x1df)](),_0x428cdb(0x1e7)),mainDir=path[_0x428cdb(0x22e)](process['cwd'](),main_dir);if(!fs['existsSync'](tempDir))fs[_0x428cdb(0x23a)](tempDir,{'recursive':!![]});if(!fs['existsSync'](uploadSessionsDir))fs[_0x428cdb(0x23a)](uploadSessionsDir,{'recursive':!![]});if(!fs[_0x428cdb(0x1db)](mainDir))fs[_0x428cdb(0x23a)](mainDir,{'recursive':!![]});const storage=multer[_0x428cdb(0x1b4)]({'destination':(_0x2971b3,_0x5ad80f,_0x59677f)=>_0x59677f(null,tempDir),'filename':(_0x1a82f8,_0x21d796,_0x10b091)=>_0x10b091(null,uuidv4())}),upload=multer({'storage':storage}),{authenticateUser,encodeAuth,decodeAuth}=require('./middleware/auth'),evelodbConfig=require(_0x428cdb(0x1d5)),eveloDB=require(_0x428cdb(0x1da));let db;function _0x291e(_0x1c2f0b,_0x4dc8a7){const _0x2d5279=_0x2d52();return _0x291e=function(_0x291e8a,_0x1815c8){_0x291e8a=_0x291e8a-0x182;let _0x15f42c=_0x2d5279[_0x291e8a];return _0x15f42c;},_0x291e(_0x1c2f0b,_0x4dc8a7);}function _0x2d52(){const _0x6a285=['existsSync','pm2\x20restart\x20','Failed\x20to\x20read\x20file','role','cwd','check','username','Failed\x20to\x20delete\x20directory','You\x20don\x27t\x20have\x20permission\x20to\x20read\x20this\x20directory','fileSizeLimit','statSync','log','temp_uploads','success','isDirectory','startsWith','localhost','Failed\x20to\x20rename\x20item','Access-Control-Allow-Methods','renameSync','15onZZBl','3457485UCSVtH','Path\x20not\x20found','error','616909mkgXEX','size','/api/create-file','headers','/api/download-zip/*','You\x20don\x27t\x20have\x20permission\x20to\x20create\x20files','2gb','175134FUhDtn','git\x20stash','http://localhost:3958','mtime','20gnodgd','setHeader','http://localhost:3000','Invalid\x20username\x20or\x20password','writeFile','You\x20don\x27t\x20have\x20permission\x20to\x20create\x20folders','unlink','Missing\x20required\x20fields','GET,\x20POST,\x20PUT,\x20DELETE,\x20PATCH,\x20OPTIONS','values','delete','admin','Item\x20renamed\x20successfully','path','Invalid\x20authentication','Access\x20denied','mkdir','Content-Type','readFile','child_process','users','includes','Username\x20already\x20exists','readFileSync','Storage\x20limit\x20exceeded','/api/createuser','replace','flat','push','map','Update\x20failed','stat','dirname','params','end','internal','exports','promises','/api/edituser/:username','readdir','/api/writecontent/*','/filemanager/dist','basename','Access-Control-Allow-Headers','User\x20deleted\x20successfully','User\x20not\x20found','Update\x20completed\x20successfully','upload','join','git\x20pull','/api/settings','address','write','create','query','Cleanup\x20error:','multer','File\x20uploaded\x20successfully','File\x20not\x20found','catch','mkdirSync','Archiving\x20error:','exit','content-length','files','message','json','File\x20creation\x20error:','array','uuid','networkInterfaces','/api/upload-chunk','directory','Failed\x20to\x20initialize\x20database:','permissions','originalname','npm\x20install','Failed\x20to\x20save\x20uploaded\x20files','sizeLimit','297028rIIfEV','normalize','/homepage','.zip\x22','writeFileSync','Blocked\x20by\x20CORS\x20policy','single','family','/api/create-folder','read','You\x20don\x27t\x20have\x20permission\x20to\x20download\x20files','/api/rename','body','Login\x20successful','Failed\x20to\x20create\x20folder','Access-Control-Allow-Origin','/api/delete/*','./middleware/dataManager','zip','.part','100GB','File\x20or\x20directory\x20not\x20found','/api/deleteuser/:username','/api/upload','Directory\x20size\x20exceeds\x20download\x20limit','/api/content/*','File\x20saved\x20successfully','7tyFfcX','Chunk\x20','get','You\x20don\x27t\x20have\x20permission\x20to\x20rename\x20files','status','180iWxCcb','edit','You\x20don\x27t\x20have\x20permission\x20to\x20write\x20files','express','2044339ZsMelh','name','1012315TamSTz','header','archiver','isFile','diskStorage','Pulse\x20received','Failed\x20to\x20read\x20directory','find','Only\x20administrators\x20can\x20modify\x20settings','current-directory','/files','Files\x20uploaded\x20with\x20folder\x20structure\x20preserved','[UPLOAD\x20ERROR]','temp_upload_sessions','rename','echo\x20\x22No\x20updates\x20available\x22','finalize','unlinkSync','rmdirSync','7735256TvGzBI','application/zip','readdirSync','authorization','Failed\x20to\x20write\x20file','findOne','download','isArray','\x20uploaded','relative','count','evelocore-cdn','use','post','length','npm\x20run\x20build','user','cors','./middleware/evelodb-config','Failed\x20to\x20create\x20file','utf8','500GB','paths','evelodb'];_0x2d52=function(){return _0x6a285;};return _0x2d52();}try{db=new eveloDB(evelodbConfig);}catch(_0x549de5){console[_0x428cdb(0x1f2)](_0x428cdb(0x184),_0x549de5),process[_0x428cdb(0x23c)](0x1);}function localLogger(_0x40dafd,_0x1e3ff1){console['log'](_0x1e3ff1,_0x40dafd);}const {calculateDirectorySize,formatSize,parseSizeLimit,requireAdmin}=require('./middleware/tools');function setupApiRoutes(_0x5a1dfa){const _0x16bf0e=_0x428cdb,_0x53d02b=['https://cdn.evelocore.com',_0x16bf0e(0x1fc),_0x16bf0e(0x200),'https://xdtsc7cg-3958.asse.devtunnels.ms'],_0x9342b4={'origin':(_0x2335a1,_0x153a10)=>{const _0x53ac3e=_0x16bf0e;!_0x2335a1||_0x53d02b['includes'](_0x2335a1)?_0x153a10(null,!![]):_0x153a10(new Error(_0x53ac3e(0x18f)));},'credentials':!![]};_0x5a1dfa['use'](cors()),_0x5a1dfa[_0x16bf0e(0x1cf)]((_0x5b3e57,_0x22ec86,_0x30fbfc)=>{const _0x3e6975=_0x16bf0e;_0x22ec86[_0x3e6975(0x1b1)](_0x3e6975(0x199),'*'),_0x22ec86[_0x3e6975(0x1b1)](_0x3e6975(0x1ed),_0x3e6975(0x206)),_0x22ec86['header'](_0x3e6975(0x229),_0x3e6975(0x20f)),_0x30fbfc();}),_0x5a1dfa[_0x16bf0e(0x1cf)](express['json']({'limit':'2gb'})),_0x5a1dfa[_0x16bf0e(0x1cf)](express['urlencoded']({'limit':_0x16bf0e(0x1f9),'extended':!![]})),_0x5a1dfa[_0x16bf0e(0x1cf)](express['static'](process['cwd']()+_0x16bf0e(0x18c))),_0x5a1dfa[_0x16bf0e(0x1cf)](_0x16bf0e(0x1ba),express['static'](process[_0x16bf0e(0x1df)]()+'/'+main_dir)),_0x5a1dfa['use']('/filemanager',express['static'](process['cwd']()+_0x16bf0e(0x227))),_0x5a1dfa[_0x16bf0e(0x1cf)](bodyParser[_0x16bf0e(0x240)]());const {getConfig:_0x213f63,writeConfig:_0x271361,updateConfig:_0x43b7fb}=require(_0x16bf0e(0x19b));_0x5a1dfa[_0x16bf0e(0x1d0)]('/api/settings',authenticateUser,(_0x5f2a5b,_0x11298d)=>{const _0x4ad3ec=_0x16bf0e;if(_0x5f2a5b[_0x4ad3ec(0x1d3)][_0x4ad3ec(0x1de)]!==_0x4ad3ec(0x209))return _0x11298d[_0x4ad3ec(0x1a9)](0x193)[_0x4ad3ec(0x240)]({'error':_0x4ad3ec(0x1b8)});const _0x1c124e=_0x5f2a5b[_0x4ad3ec(0x196)];_0x43b7fb(_0x1c124e);const _0x49a48e=_0x213f63();_0x11298d['json']({'success':!![],'message':'Settings\x20updated\x20successfully','data':_0x49a48e});}),_0x5a1dfa['get'](_0x16bf0e(0x230),async(_0x464ab8,_0x28765f)=>{const _0x21a770=_0x16bf0e,_0x4e88ea=_0x213f63(),_0x1433c6=path['join'](process[_0x21a770(0x1df)](),main_dir),_0x5290b6=formatSize(await calculateDirectorySize(_0x1433c6));_0x28765f[_0x21a770(0x240)]({'success':!![],'data':{..._0x4e88ea,'usedStorage':_0x5290b6}});}),_0x5a1dfa[_0x16bf0e(0x1d0)]('/api/login',async(_0x5a838c,_0x5bb2f5)=>{const _0x4a4680=_0x16bf0e;let {username:_0x356fa5,password:_0x43b32a,auth:auth=''}=_0x5a838c['body'];if(auth){[_0x356fa5,_0x43b32a]=decodeAuth(auth);if(!_0x356fa5||!_0x43b32a)return _0x5bb2f5[_0x4a4680(0x1a9)](0x191)[_0x4a4680(0x240)]({'error':_0x4a4680(0x20c)});}if(_0x356fa5[_0x4a4680(0x1d1)]<0x3||_0x43b32a[_0x4a4680(0x1d1)]<0x3)return _0x5bb2f5[_0x4a4680(0x1a9)](0x190)['json']({'error':'Username\x20and\x20password\x20must\x20be\x20at\x20least\x203\x20characters\x20long'});const _0x36ff13=db[_0x4a4680(0x1a7)](_0x4a4680(0x212))[_0x4a4680(0x1cd)]();if(_0x36ff13===0x0){const _0x220002=db[_0x4a4680(0x233)](_0x4a4680(0x212),{'username':_0x356fa5,'password':_0x43b32a,'role':_0x4a4680(0x209),'permissions':[_0x4a4680(0x193),_0x4a4680(0x22d),_0x4a4680(0x208),_0x4a4680(0x233),'rename',_0x4a4680(0x1c9)],'sizeLimit':'','directory':'/'});}const _0x1fce38=db[_0x4a4680(0x1c8)](_0x4a4680(0x212),{'username':_0x356fa5,'password':_0x43b32a});if(_0x1fce38){const _0x1e3373=encodeAuth(_0x356fa5,_0x43b32a),_0x20401d=_0x1fce38[_0x4a4680(0x183)],_0x256226=path[_0x4a4680(0x22e)](process['cwd'](),main_dir,_0x20401d),_0x2d0f34=await calculateDirectorySize(_0x256226);_0x5bb2f5[_0x4a4680(0x240)]({'success':!![],'message':_0x4a4680(0x197),'ip':serverIp,'role':_0x1fce38['role'],'user':_0x1fce38,'usedSpace':formatSize(_0x2d0f34),'auth':''+_0x1e3373});}else _0x5bb2f5['json']({'success':![],'message':_0x4a4680(0x201)});}),_0x5a1dfa['get']('/api/files/*',authenticateUser,(_0x14b851,_0x4f0c5a)=>{const _0x513add=_0x16bf0e,_0x484336=_0x14b851[_0x513add(0x21f)][0x0]||'',_0x1736f8=_0x14b851[_0x513add(0x1d3)][_0x513add(0x183)],_0x4148f8=path[_0x513add(0x22e)](process[_0x513add(0x1df)](),main_dir,_0x1736f8,_0x484336);if(!_0x14b851[_0x513add(0x1d3)][_0x513add(0x185)][_0x513add(0x213)](_0x513add(0x193)))return _0x4f0c5a['status'](0x193)[_0x513add(0x240)]({'error':_0x513add(0x1e3)});if(!_0x4148f8[_0x513add(0x1ea)](path[_0x513add(0x22e)](process[_0x513add(0x1df)](),main_dir,_0x1736f8)))return _0x4f0c5a[_0x513add(0x1a9)](0x193)[_0x513add(0x240)]({'error':_0x513add(0x20d)});fs[_0x513add(0x225)](_0x4148f8,{'withFileTypes':!![]},(_0x3394c3,_0x41f14f)=>{const _0x1b7a2e=_0x513add;if(_0x3394c3)return _0x4f0c5a['status'](0x1f4)['json']({'error':_0x1b7a2e(0x1b6)});const _0x432ec4=_0x41f14f[_0x1b7a2e(0x21b)](_0x22e375=>({'name':_0x22e375[_0x1b7a2e(0x1af)],'path':path['join'](_0x484336,_0x22e375[_0x1b7a2e(0x1af)]),'isDirectory':_0x22e375[_0x1b7a2e(0x1e9)](),'size':_0x22e375[_0x1b7a2e(0x1e9)]()?'-':fs[_0x1b7a2e(0x1e5)](path['join'](_0x4148f8,_0x22e375[_0x1b7a2e(0x1af)]))[_0x1b7a2e(0x1f4)],'modified':fs[_0x1b7a2e(0x1e5)](path[_0x1b7a2e(0x22e)](_0x4148f8,_0x22e375[_0x1b7a2e(0x1af)]))[_0x1b7a2e(0x1fd)]}));_0x4f0c5a[_0x1b7a2e(0x240)]({'currentPath':_0x484336,'files':_0x432ec4});});}),_0x5a1dfa['post'](_0x16bf0e(0x1a1),authenticateUser,upload[_0x16bf0e(0x242)](_0x16bf0e(0x23e)),async(_0x300040,_0x15da2c)=>{const _0x115de6=_0x16bf0e;try{const _0x36aa42=_0x300040[_0x115de6(0x1d3)][_0x115de6(0x183)],_0x526c89=_0x300040['headers'][_0x115de6(0x1b9)]||'',_0x4b47b5=path['join'](process[_0x115de6(0x1df)](),main_dir,_0x36aa42),_0x40ad37=path[_0x115de6(0x22e)](_0x4b47b5,_0x526c89),_0x380ac3=path[_0x115de6(0x18b)](_0x4b47b5),_0x30d2ef=_0x300040['files'][_0x115de6(0x21b)](_0x48461e=>_0x48461e[_0x115de6(0x186)]),_0x5c0b60=_0x300040[_0x115de6(0x196)][_0x115de6(0x1d9)]?Array[_0x115de6(0x1ca)](_0x300040[_0x115de6(0x196)][_0x115de6(0x1d9)])?_0x300040[_0x115de6(0x196)][_0x115de6(0x1d9)]:[_0x300040[_0x115de6(0x196)][_0x115de6(0x1d9)]]:_0x30d2ef,_0x1587d4=[];for(let _0x246c19=0x0;_0x246c19<_0x300040[_0x115de6(0x23e)]['length'];_0x246c19++){const _0x57c08e=_0x300040[_0x115de6(0x23e)][_0x246c19],_0x96d655=_0x5c0b60[_0x246c19][_0x115de6(0x218)](/::path-separator::/g,'/'),_0x36fb6a=path[_0x115de6(0x22e)](_0x40ad37,_0x96d655),_0x2b33c2=path[_0x115de6(0x18b)](_0x36fb6a);if(!_0x2b33c2[_0x115de6(0x1ea)](_0x380ac3))throw new Error('Access\x20denied:\x20Unsafe\x20path');await fs[_0x115de6(0x223)][_0x115de6(0x20e)](path['dirname'](_0x2b33c2),{'recursive':!![]}),await fs['promises'][_0x115de6(0x1be)](_0x57c08e[_0x115de6(0x20b)],_0x2b33c2),_0x1587d4['push']({'path':_0x96d655,'size':_0x57c08e[_0x115de6(0x1f4)]});}const _0x2fea60=await calculateDirectorySize(_0x4b47b5);_0x15da2c[_0x115de6(0x240)]({'success':!![],'message':_0x115de6(0x1bb),'usedSpace':formatSize(_0x2fea60),'files':_0x1587d4});}catch(_0x58536f){console[_0x115de6(0x1f2)](_0x115de6(0x1bc),_0x58536f),_0x15da2c[_0x115de6(0x1a9)](0x1f4)[_0x115de6(0x240)]({'error':_0x115de6(0x188),'details':_0x58536f[_0x115de6(0x23f)]});}finally{_0x300040[_0x115de6(0x23e)]&&_0x300040[_0x115de6(0x23e)]['forEach'](_0x5ea0d2=>{const _0x381c32=_0x115de6;try{fs[_0x381c32(0x1db)](_0x5ea0d2['path'])&&fs['unlinkSync'](_0x5ea0d2[_0x381c32(0x20b)]);}catch(_0x21bd13){console[_0x381c32(0x1f2)](_0x381c32(0x235),_0x21bd13);}});}}),_0x5a1dfa[_0x16bf0e(0x1d0)](_0x16bf0e(0x182),authenticateUser,(_0x4cc507,_0x4215e3)=>{const _0x398a6a=_0x16bf0e;upload[_0x398a6a(0x190)]('file')(_0x4cc507,_0x4215e3,async _0x50e13a=>{const _0x18c7a5=_0x398a6a;if(_0x50e13a)return _0x4215e3[_0x18c7a5(0x1a9)](0x1f4)[_0x18c7a5(0x240)]({'success':![],'message':'Upload\x20failed','error':_0x50e13a[_0x18c7a5(0x23f)]});const {fileName:_0x45cb91,chunkIndex:_0x7a2589,totalChunks:_0x225226,uploadId:_0x4c025d,uploadPath:uploadPath=''}=_0x4cc507['body'];if(!_0x45cb91||_0x7a2589===undefined||!_0x225226||!_0x4c025d)return _0x4215e3[_0x18c7a5(0x1a9)](0x190)[_0x18c7a5(0x240)]({'error':_0x18c7a5(0x205)});const _0x4c4824=_0x4cc507[_0x18c7a5(0x1d3)][_0x18c7a5(0x183)],_0x44cb37=path[_0x18c7a5(0x22e)](process[_0x18c7a5(0x1df)](),main_dir,_0x4c4824,uploadPath),_0x925ba3=path[_0x18c7a5(0x22e)](process[_0x18c7a5(0x1df)](),main_dir,_0x4c4824);if(!_0x44cb37[_0x18c7a5(0x1ea)](_0x925ba3))return _0x4215e3[_0x18c7a5(0x1a9)](0x193)[_0x18c7a5(0x240)]({'error':'Access\x20denied'});const _0x3fb636=_0x4cc507['headers'][_0x18c7a5(0x23d)],_0x359afd=parseSizeLimit(_0x4cc507[_0x18c7a5(0x1d3)][_0x18c7a5(0x189)]||_0x18c7a5(0x19e)),_0x4d1b02=await calculateDirectorySize(_0x44cb37);if(_0x4d1b02+Number(_0x3fb636)>_0x359afd)return _0x4215e3['status'](0x19d)[_0x18c7a5(0x240)]({'error':_0x18c7a5(0x216),'current':formatSize(_0x4d1b02),'limit':_0x4cc507[_0x18c7a5(0x1d3)]['sizeLimit']});const _0x103b97=parseSizeLimit(_0x213f63()[_0x18c7a5(0x1b4)]||_0x18c7a5(0x1d8)),_0x5bc11d=path['join'](process[_0x18c7a5(0x1df)](),main_dir),_0x5d5eef=await calculateDirectorySize(_0x5bc11d);if(_0x5d5eef+Number(_0x3fb636)>_0x103b97)return _0x4215e3[_0x18c7a5(0x1a9)](0x1f4)[_0x18c7a5(0x240)]({'error':'Disk\x20limit\x20exceeded'});const _0x1aec17=path['join'](uploadSessionsDir,_0x4c025d);fs[_0x18c7a5(0x23a)](_0x1aec17,{'recursive':!![]});const _0x361954=path[_0x18c7a5(0x22e)](_0x1aec17,_0x7a2589+_0x18c7a5(0x19d));fs[_0x18c7a5(0x1ee)](_0x4cc507['file'][_0x18c7a5(0x20b)],_0x361954);const _0x101c3d=fs['readdirSync'](_0x1aec17)[_0x18c7a5(0x1d1)];if(_0x101c3d==parseInt(_0x225226)){fs[_0x18c7a5(0x23a)](_0x44cb37,{'recursive':!![]});const _0xfb3c63=path[_0x18c7a5(0x22e)](_0x44cb37,_0x45cb91),_0x518978=fs['createWriteStream'](_0xfb3c63);for(let _0x4424b=0x0;_0x4424b<_0x225226;_0x4424b++){const _0x37c514=path[_0x18c7a5(0x22e)](_0x1aec17,_0x4424b+_0x18c7a5(0x19d)),_0x28f019=fs[_0x18c7a5(0x215)](_0x37c514);_0x518978[_0x18c7a5(0x232)](_0x28f019),fs[_0x18c7a5(0x1c1)](_0x37c514);}_0x518978[_0x18c7a5(0x220)](),fs[_0x18c7a5(0x1c2)](_0x1aec17);const _0x39541a=await calculateDirectorySize(_0x44cb37);return _0x4215e3[_0x18c7a5(0x240)]({'success':!![],'message':_0x18c7a5(0x237),'path':path['join'](_0x4c4824,uploadPath),'usedSpace':formatSize(_0x39541a)});}_0x4215e3[_0x18c7a5(0x240)]({'success':!![],'message':_0x18c7a5(0x1a6)+_0x7a2589+_0x18c7a5(0x1cb),'chunkIndex':_0x7a2589});});}),_0x5a1dfa[_0x16bf0e(0x1d0)](_0x16bf0e(0x192),authenticateUser,(_0x481d9f,_0x41beaa)=>{const _0x4135bc=_0x16bf0e;if(!_0x481d9f[_0x4135bc(0x1d3)]['permissions'][_0x4135bc(0x213)](_0x4135bc(0x233)))return _0x41beaa[_0x4135bc(0x1a9)](0x193)[_0x4135bc(0x240)]({'error':_0x4135bc(0x203)});const {path:_0x211ad9,folderName:_0x4316be}=_0x481d9f[_0x4135bc(0x196)],_0x3ff5ef=_0x481d9f[_0x4135bc(0x1d3)][_0x4135bc(0x183)],_0x40f662=path[_0x4135bc(0x18b)](_0x211ad9)[_0x4135bc(0x218)](/^(\.\.(\/|\\|$))+/,''),_0x19ffd0=path['normalize'](_0x4316be)[_0x4135bc(0x218)](/^(\.\.(\/|\\|$))+/,''),_0xc1b058=path[_0x4135bc(0x22e)](process[_0x4135bc(0x1df)](),main_dir,_0x3ff5ef,_0x40f662,_0x19ffd0);if(!_0xc1b058[_0x4135bc(0x1ea)](path['join'](process[_0x4135bc(0x1df)](),main_dir,_0x3ff5ef)))return _0x41beaa['status'](0x193)['json']({'error':_0x4135bc(0x20d)});try{fs[_0x4135bc(0x23a)](_0xc1b058,{'recursive':!![]}),_0x41beaa[_0x4135bc(0x240)]({'success':!![]});}catch(_0x369701){_0x41beaa[_0x4135bc(0x1a9)](0x1f4)['json']({'success':![],'error':_0x4135bc(0x198)});}}),_0x5a1dfa['post'](_0x16bf0e(0x1f5),authenticateUser,(_0x39f432,_0x20dea3)=>{const _0x556b2f=_0x16bf0e;if(!_0x39f432[_0x556b2f(0x1d3)][_0x556b2f(0x185)][_0x556b2f(0x213)](_0x556b2f(0x233)))return _0x20dea3[_0x556b2f(0x1a9)](0x193)[_0x556b2f(0x240)]({'error':_0x556b2f(0x1f8)});const {path:_0x2015be,fileName:_0x116f5a,content:_0x22ea43}=_0x39f432[_0x556b2f(0x196)],_0x3c0e1c=_0x39f432[_0x556b2f(0x1d3)]['directory'],_0x31203a=path[_0x556b2f(0x18b)](_0x2015be)[_0x556b2f(0x218)](/^(\.\.(\/|\\|$))+/,''),_0x40936a=path[_0x556b2f(0x228)](_0x116f5a),_0x53bbf7=path['join'](process[_0x556b2f(0x1df)](),main_dir,_0x3c0e1c,_0x31203a),_0x5d1501=path[_0x556b2f(0x22e)](_0x53bbf7,_0x40936a),_0x3e0d54=path[_0x556b2f(0x22e)](process[_0x556b2f(0x1df)](),main_dir,_0x3c0e1c);if(!_0x5d1501[_0x556b2f(0x1ea)](_0x3e0d54))return _0x20dea3['status'](0x193)[_0x556b2f(0x240)]({'error':_0x556b2f(0x20d)});try{fs['mkdirSync'](_0x53bbf7,{'recursive':!![]}),fs[_0x556b2f(0x18e)](_0x5d1501,_0x22ea43||'',_0x556b2f(0x1d7)),_0x20dea3['json']({'success':!![]});}catch(_0xe0fe56){console['error'](_0x556b2f(0x241),_0xe0fe56),_0x20dea3[_0x556b2f(0x1a9)](0x1f4)[_0x556b2f(0x240)]({'success':![],'error':_0x556b2f(0x1d6)});}}),_0x5a1dfa['get']('/api/download/*',authenticateUser,(_0x416792,_0x2374d7)=>{const _0x5dc8f4=_0x16bf0e;if(!_0x416792[_0x5dc8f4(0x1d3)][_0x5dc8f4(0x185)][_0x5dc8f4(0x213)](_0x5dc8f4(0x1c9)))return _0x2374d7[_0x5dc8f4(0x1a9)](0x193)[_0x5dc8f4(0x240)]({'error':'You\x20don\x27t\x20have\x20permission\x20to\x20download\x20files'});const _0x323ec5=_0x416792[_0x5dc8f4(0x234)]['auth']||_0x416792[_0x5dc8f4(0x1f6)][_0x5dc8f4(0x1c6)];if(!_0x323ec5)return _0x2374d7['status'](0x191)[_0x5dc8f4(0x240)]({'error':'No\x20authorization\x20token\x20provided'});const _0x5dc46c=_0x416792[_0x5dc8f4(0x1d3)][_0x5dc8f4(0x183)],_0x53a1eb=path[_0x5dc8f4(0x22e)](process[_0x5dc8f4(0x1df)](),main_dir,_0x5dc46c,_0x416792[_0x5dc8f4(0x21f)][0x0]);if(!_0x53a1eb[_0x5dc8f4(0x1ea)](path['join'](process[_0x5dc8f4(0x1df)](),main_dir,_0x5dc46c)))return _0x2374d7[_0x5dc8f4(0x1a9)](0x193)[_0x5dc8f4(0x240)]({'error':_0x5dc8f4(0x20d)});_0x2374d7[_0x5dc8f4(0x1c9)](_0x53a1eb);}),_0x5a1dfa[_0x16bf0e(0x1a7)](_0x16bf0e(0x1f7),authenticateUser,async(_0x2b9676,_0x2a270c)=>{const _0x44cc20=_0x16bf0e;if(!_0x2b9676[_0x44cc20(0x1d3)][_0x44cc20(0x185)]['includes'](_0x44cc20(0x1c9)))return _0x2a270c[_0x44cc20(0x1a9)](0x193)[_0x44cc20(0x240)]({'error':_0x44cc20(0x194)});const _0x28cc59=parseSizeLimit(_0x213f63()[_0x44cc20(0x1e4)]),_0xe22947=_0x2b9676[_0x44cc20(0x1d3)]['directory'],_0xc06545=_0x2b9676['params'][0x0],_0x136315=path[_0x44cc20(0x22e)](process[_0x44cc20(0x1df)](),main_dir,_0xe22947,_0xc06545);if(!_0x136315['startsWith'](path['join'](process[_0x44cc20(0x1df)](),main_dir,_0xe22947)))return _0x2a270c[_0x44cc20(0x1a9)](0x193)[_0x44cc20(0x240)]({'error':_0x44cc20(0x20d)});if(!fs[_0x44cc20(0x1db)](_0x136315))return _0x2a270c[_0x44cc20(0x1a9)](0x194)['json']({'error':_0x44cc20(0x1f1)});const _0xcfda9c=fs['statSync'](_0x136315);if(_0xcfda9c[_0x44cc20(0x1b3)]())return _0x2a270c[_0x44cc20(0x1c9)](_0x136315);const _0x4f7c37=_0x42b076=>{const _0x15d07a=_0x44cc20;let _0x192a0b=0x0;const _0x318216=fs[_0x15d07a(0x1c5)](_0x42b076);for(const _0x5802d5 of _0x318216){const _0xe0ab89=path['join'](_0x42b076,_0x5802d5),_0x1af73c=fs[_0x15d07a(0x1e5)](_0xe0ab89);if(_0x1af73c['isFile']())_0x192a0b+=_0x1af73c[_0x15d07a(0x1f4)];else _0x1af73c['isDirectory']()&&(_0x192a0b+=_0x4f7c37(_0xe0ab89));}return _0x192a0b;},_0x5cdcf5=_0x4f7c37(_0x136315);if(_0x5cdcf5>_0x28cc59)return _0x2a270c['status'](0x19d)['json']({'error':_0x44cc20(0x1a2)});_0x2a270c['setHeader']('Content-Type',_0x44cc20(0x1c4)),_0x2a270c[_0x44cc20(0x1ff)]('Content-Disposition','attachment;\x20filename=\x22'+path['basename'](_0xc06545)+_0x44cc20(0x18d));const _0x338a91=archiver(_0x44cc20(0x19c),{'zlib':{'level':0x9}});_0x338a91[_0x44cc20(0x183)](_0x136315,![]),_0x338a91['pipe'](_0x2a270c),_0x338a91[_0x44cc20(0x1c0)]()[_0x44cc20(0x239)](_0x23b7ea=>{const _0x22dab0=_0x44cc20;console['error'](_0x22dab0(0x23b),_0x23b7ea),_0x2a270c[_0x22dab0(0x1a9)](0x1f4)[_0x22dab0(0x220)]();});}),_0x5a1dfa[_0x16bf0e(0x1a7)](_0x16bf0e(0x1a3),authenticateUser,(_0x38326,_0x3c17ab)=>{const _0x2f3996=_0x16bf0e;if(!_0x38326[_0x2f3996(0x1d3)][_0x2f3996(0x185)][_0x2f3996(0x213)](_0x2f3996(0x193)))return _0x3c17ab['status'](0x193)[_0x2f3996(0x240)]({'error':'You\x20don\x27t\x20have\x20permission\x20to\x20read\x20files'});const _0x58753a=_0x38326['params'][0x0],_0x25a529=_0x38326[_0x2f3996(0x1d3)][_0x2f3996(0x183)],_0x5d0a7d=path['join'](process['cwd'](),main_dir,_0x25a529,_0x58753a);if(!_0x5d0a7d[_0x2f3996(0x1ea)](path[_0x2f3996(0x22e)](process[_0x2f3996(0x1df)](),main_dir,_0x25a529)))return _0x3c17ab[_0x2f3996(0x1a9)](0x193)[_0x2f3996(0x240)]({'error':_0x2f3996(0x20d)});if(!fs['existsSync'](_0x5d0a7d))return _0x3c17ab[_0x2f3996(0x1a9)](0x194)['json']({'error':_0x2f3996(0x238)});const _0x280363=fs['statSync'](_0x5d0a7d);if(!_0x280363[_0x2f3996(0x1b3)]())return _0x3c17ab['status'](0x190)[_0x2f3996(0x240)]({'error':'Path\x20is\x20not\x20a\x20file'});fs[_0x2f3996(0x210)](_0x5d0a7d,'utf8',(_0x443cb2,_0x2b0c18)=>{const _0x58f9b5=_0x2f3996;if(_0x443cb2)return _0x3c17ab['status'](0x1f4)[_0x58f9b5(0x240)]({'error':_0x58f9b5(0x1dd)});_0x3c17ab[_0x58f9b5(0x240)]({'success':!![],'content':_0x2b0c18,'modified':_0x280363[_0x58f9b5(0x1fd)],'size':_0x280363[_0x58f9b5(0x1f4)]});});}),_0x5a1dfa['post'](_0x16bf0e(0x226),authenticateUser,(_0x44bbbe,_0x29ec8f)=>{const _0x14abba=_0x16bf0e;if(!_0x44bbbe['user'][_0x14abba(0x185)]['includes'](_0x14abba(0x22d)))return _0x29ec8f['status'](0x193)[_0x14abba(0x240)]({'error':_0x14abba(0x1ac)});const _0x1d46da=_0x44bbbe[_0x14abba(0x21f)][0x0],{content:_0x219472}=_0x44bbbe['body'],_0x4ae7a1=_0x44bbbe[_0x14abba(0x1d3)][_0x14abba(0x183)],_0x347474=path[_0x14abba(0x22e)](process['cwd'](),main_dir,_0x4ae7a1,_0x1d46da);if(!_0x347474[_0x14abba(0x1ea)](path[_0x14abba(0x22e)](process[_0x14abba(0x1df)](),main_dir,_0x4ae7a1)))return _0x29ec8f[_0x14abba(0x1a9)](0x193)[_0x14abba(0x240)]({'error':_0x14abba(0x20d)});const _0xb40d0d=path['dirname'](_0x347474);!fs[_0x14abba(0x1db)](_0xb40d0d)&&fs['mkdirSync'](_0xb40d0d,{'recursive':!![]}),fs[_0x14abba(0x202)](_0x347474,_0x219472,_0x14abba(0x1d7),_0x405af3=>{const _0x1b2ceb=_0x14abba;if(_0x405af3)return _0x29ec8f['status'](0x1f4)[_0x1b2ceb(0x240)]({'error':_0x1b2ceb(0x1c7)});const _0x531c83=fs[_0x1b2ceb(0x1e5)](_0x347474);_0x29ec8f[_0x1b2ceb(0x240)]({'success':!![],'message':_0x1b2ceb(0x1a4),'modified':_0x531c83[_0x1b2ceb(0x1fd)],'size':_0x531c83[_0x1b2ceb(0x1f4)]});});}),_0x5a1dfa[_0x16bf0e(0x208)](_0x16bf0e(0x19a),authenticateUser,(_0x53bead,_0x36434e)=>{const _0x5ddc48=_0x16bf0e;if(!_0x53bead['user'][_0x5ddc48(0x185)][_0x5ddc48(0x213)](_0x5ddc48(0x208)))return _0x36434e['status'](0x193)['json']({'error':'You\x20don\x27t\x20have\x20permission\x20to\x20delete\x20files'});const _0x3e853e=_0x53bead[_0x5ddc48(0x21f)][0x0],_0x24c5f3=_0x53bead[_0x5ddc48(0x1d3)][_0x5ddc48(0x183)],_0x235648=path['join'](process[_0x5ddc48(0x1df)](),main_dir,_0x24c5f3,_0x3e853e);if(!_0x235648['startsWith'](path[_0x5ddc48(0x22e)](process['cwd'](),main_dir,_0x24c5f3)))return _0x36434e[_0x5ddc48(0x1a9)](0x193)[_0x5ddc48(0x240)]({'error':'Access\x20denied'});fs[_0x5ddc48(0x21d)](_0x235648,(_0x2a3c56,_0x28b90e)=>{const _0x3c3ad3=_0x5ddc48;if(_0x2a3c56)return _0x36434e[_0x3c3ad3(0x1a9)](0x194)[_0x3c3ad3(0x240)]({'error':_0x3c3ad3(0x19f)});_0x28b90e[_0x3c3ad3(0x1e9)]()?fs['rm'](_0x235648,{'recursive':!![]},async _0x31502e=>{const _0x289576=_0x3c3ad3;if(_0x31502e)return _0x36434e['status'](0x1f4)[_0x289576(0x240)]({'error':_0x289576(0x1e2)});const _0x4d9157=path['join'](process[_0x289576(0x1df)](),main_dir,_0x24c5f3),_0x38e062=await calculateDirectorySize(_0x4d9157);_0x36434e['json']({'success':!![],'usedSpace':formatSize(_0x38e062)});}):fs[_0x3c3ad3(0x204)](_0x235648,async _0x1dfdfe=>{const _0x1dfd71=_0x3c3ad3;if(_0x1dfdfe)return _0x36434e[_0x1dfd71(0x1a9)](0x1f4)[_0x1dfd71(0x240)]({'error':'Failed\x20to\x20delete\x20file'});const _0x384d61=path[_0x1dfd71(0x22e)](process[_0x1dfd71(0x1df)](),main_dir,_0x24c5f3),_0x38716d=await calculateDirectorySize(_0x384d61);_0x36434e[_0x1dfd71(0x240)]({'success':!![],'usedSpace':formatSize(_0x38716d)});});});}),_0x5a1dfa[_0x16bf0e(0x1d0)](_0x16bf0e(0x195),authenticateUser,(_0x48ed5a,_0x244c1f)=>{const _0x1685fb=_0x16bf0e;if(!_0x48ed5a[_0x1685fb(0x1d3)][_0x1685fb(0x185)][_0x1685fb(0x213)](_0x1685fb(0x1be)))return _0x244c1f['status'](0x193)[_0x1685fb(0x240)]({'error':_0x1685fb(0x1a8)});const {oldPath:_0xa81e6c,newName:_0x3b2dff}=_0x48ed5a[_0x1685fb(0x196)],_0x50913f=_0x48ed5a['user']['directory'],_0x2cef32=path[_0x1685fb(0x22e)](process[_0x1685fb(0x1df)](),main_dir,_0x50913f,_0xa81e6c),_0x437c55=path['join'](path[_0x1685fb(0x21e)](_0x2cef32),_0x3b2dff);if(!_0x2cef32['startsWith'](path[_0x1685fb(0x22e)](process[_0x1685fb(0x1df)](),main_dir,_0x50913f)))return _0x244c1f[_0x1685fb(0x1a9)](0x193)['json']({'error':_0x1685fb(0x20d)});fs[_0x1685fb(0x1be)](_0x2cef32,_0x437c55,_0x259d36=>{const _0x368835=_0x1685fb;if(_0x259d36)return _0x244c1f[_0x368835(0x1a9)](0x1f4)[_0x368835(0x240)]({'success':![],'message':_0x368835(0x1ec),'error':_0x259d36[_0x368835(0x23f)]});_0x244c1f['json']({'success':!![],'message':_0x368835(0x20a),'newPath':path[_0x368835(0x1cc)](path[_0x368835(0x22e)](process[_0x368835(0x1df)](),main_dir,_0x50913f),_0x437c55)});});}),_0x5a1dfa['get']('/api/getusers',authenticateUser,requireAdmin,(_0x5633fd,_0x55eb15)=>{const _0x302765=_0x16bf0e,_0x20b80c=db[_0x302765(0x1a7)](_0x302765(0x212))['all']();_0x55eb15[_0x302765(0x240)]({'success':!![],'users':_0x20b80c});}),_0x5a1dfa['post'](_0x16bf0e(0x217),authenticateUser,requireAdmin,(_0x3176b5,_0x305565)=>{const _0x48a01a=_0x16bf0e,{username:_0x155a13,password:_0x5878f1,role:_0x4e3d6b,sizeLimit:_0x557d,directory:_0x79f37a,permissions:_0x745bff}=_0x3176b5[_0x48a01a(0x196)];if(!_0x155a13||!_0x5878f1||!_0x4e3d6b||!_0x79f37a)return _0x305565[_0x48a01a(0x1a9)](0x190)[_0x48a01a(0x240)]({'error':_0x48a01a(0x205)});const _0x52eb27=db[_0x48a01a(0x1e0)](_0x48a01a(0x212),{'username':_0x155a13});if(_0x52eb27)return _0x305565[_0x48a01a(0x1a9)](0x190)[_0x48a01a(0x240)]({'error':_0x48a01a(0x214)});db['create'](_0x48a01a(0x212),{'username':_0x155a13,'password':_0x5878f1,'role':_0x4e3d6b,'sizeLimit':_0x557d,'directory':_0x79f37a,'permissions':_0x745bff||[_0x48a01a(0x193)]}),_0x305565[_0x48a01a(0x240)]({'success':!![],'message':'User\x20created\x20successfully'});}),_0x5a1dfa['delete'](_0x16bf0e(0x1a0),authenticateUser,requireAdmin,(_0x3fc0ea,_0x41349a)=>{const _0x4c7c5f=_0x16bf0e,_0x236a54=_0x3fc0ea[_0x4c7c5f(0x21f)]['username'],_0x38dc82=db[_0x4c7c5f(0x1e0)](_0x4c7c5f(0x212),{'username':_0x236a54});if(!_0x38dc82)return _0x41349a[_0x4c7c5f(0x1a9)](0x194)['json']({'error':'User\x20not\x20found'});db[_0x4c7c5f(0x208)]('users',{'username':_0x236a54}),_0x41349a['json']({'success':!![],'message':_0x4c7c5f(0x22a)});}),_0x5a1dfa['put'](_0x16bf0e(0x224),authenticateUser,requireAdmin,(_0x1e083c,_0x337731)=>{const _0x178461=_0x16bf0e,_0x29ecae=_0x1e083c[_0x178461(0x21f)][_0x178461(0x1e1)],_0x40f69b=_0x1e083c[_0x178461(0x196)],_0x2c4ed3=db['check'](_0x178461(0x212),{'username':_0x29ecae});if(!_0x2c4ed3)return _0x337731['status'](0x194)[_0x178461(0x240)]({'error':_0x178461(0x22b)});const _0x5bfddc=db[_0x178461(0x1ab)](_0x178461(0x212),{'username':_0x29ecae},_0x40f69b);_0x5bfddc[_0x178461(0x1e8)]?_0x337731[_0x178461(0x240)]({'success':!![],'message':'User\x20updated\x20successfully'}):_0x337731[_0x178461(0x1a9)](0x190)[_0x178461(0x240)]({'error':_0x5bfddc[_0x178461(0x23f)]||'Failed\x20to\x20update\x20user'});}),_0x5a1dfa[_0x16bf0e(0x1d0)]('/api/github-webhook',authenticateUser,requireAdmin,(_0x1cf6a0,_0x574ad7)=>{const _0x45749d=_0x16bf0e,{gitPull:_0x1d5ecf,gitStash:_0x15c022,npmInstall:_0x85ec80,pmRestart:_0xf527c4,npmBuild:_0x4821ea}=_0x1cf6a0[_0x45749d(0x196)],_0x255456=[],_0x2d8f67=_0x45749d(0x1ce);if(_0x15c022)_0x255456[_0x45749d(0x21a)](_0x45749d(0x1fb));if(_0x1d5ecf)_0x255456[_0x45749d(0x21a)](_0x45749d(0x22f));if(_0x85ec80)_0x255456[_0x45749d(0x21a)](_0x45749d(0x187));if(_0x4821ea)_0x255456[_0x45749d(0x21a)](_0x45749d(0x1d2));const _0x2e0188=_0x45749d(0x1dc)+_0x2d8f67,_0xe85723=_0x255456[_0x45749d(0x1d1)]>0x0?_0x255456[_0x45749d(0x22e)]('\x20&&\x20'):_0xf527c4?_0x2e0188:_0x45749d(0x1bf);exec(_0xe85723,(_0x36e50f,_0x5e08ea,_0x27c8ee)=>{const _0x4bb1d1=_0x45749d;if(_0x36e50f)return _0x574ad7[_0x4bb1d1(0x240)]({'success':![],'message':'Update\x20failed','error':_0x36e50f,'stdout':_0x5e08ea,'stderr':_0x27c8ee});else _0xf527c4&&exec(_0x2e0188,(_0x5a5034,_0x2a4f4b,_0x5ca83c)=>{const _0x5b4040=_0x4bb1d1;if(_0x5a5034)return _0x574ad7['json']({'success':![],'message':_0x5b4040(0x21c),'error':_0x5a5034,'stdout':_0x2a4f4b,'stderr':_0x5ca83c});_0x574ad7['json']({'success':!![],'message':_0x5b4040(0x22c),'details':_0x2a4f4b});});_0x574ad7[_0x4bb1d1(0x240)]({'success':!![],'message':_0x4bb1d1(0x22c),'details':_0x5e08ea});});}),_0x5a1dfa[_0x16bf0e(0x1d0)]('/apitest/pulse',(_0x410e27,_0x49d010)=>{const _0x1298d0=_0x16bf0e,_0x53df0e=new Date()['toLocaleTimeString']();console[_0x1298d0(0x1e6)](_0x53df0e,_0x1298d0(0x1b5)),console['log'](_0x410e27[_0x1298d0(0x196)]),_0x49d010[_0x1298d0(0x240)]({'success':!![]});}),_0x5a1dfa[_0x16bf0e(0x1d0)]('/api/download',async(_0xc9ff39,_0x2cb080)=>{const _0x375443=_0x16bf0e,{url:_0x177872}=_0xc9ff39[_0x375443(0x196)];try{console[_0x375443(0x1e6)]('Downloading:',_0xc9ff39['body']),_0x2cb080[_0x375443(0x240)]({'success':!![]});}catch(_0x3d4871){_0x2cb080['status'](0x1f4)[_0x375443(0x240)]({'error':_0x3d4871[_0x375443(0x23f)]});}});}module[_0x428cdb(0x222)]={'setupApiRoutes':setupApiRoutes};